rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Users collection - allow authenticated users to create/update their own data
    match /users/{userId} {
      // Allow any authenticated user to read their own data
      allow read: if request.auth != null && request.auth.uid == userId;

      // Allow users to write their own data during registration
      allow create, update: if request.auth != null && request.auth.uid == userId;

      // Prevent deletion for safety
      allow delete: if false;
    }

    // Contact submissions - authenticated users can create, admins can read all
    match /contact_submissions/{submissionId} {
      // Allow authenticated users to create submissions
      allow create: if request.auth != null;

      // Allow users to read their own submissions
      allow read: if request.auth != null &&
                     (resource.data.userId == request.auth.uid ||
                      resource.data.userEmail == request.auth.token.email);

      // Only allow updates and deletes by admin (you'll need to add admin check)
      allow update, delete: if false; // Change this when you add admin functionality
    }
  }
}
